#bash script for running smc++

#bgzip and tabix vcf file

#get list of scaffolds to perform analysis restrict analysis to scaffolds >1Mb
#for loop to convert each scaffold to smc file
while read scaf
do
	for i in MVZCCGP-CaOr2_I-B01 MVZCCGP-CaOr21_I-H02 MVZCCGP-CaOr11_I-A02 MVZCCGP-CaOr3_II-A07 MVZCCGP-CaOr25_I-D03
	do
		smc++ vcf2smc -d $i $i /media/data2/Quail_reanalysis/CalQuail_Autosome_16Sept.recode.vcf.gz Cal_$i.${scaf}.smc.gz "$scaf" --mask ../MissingSites_mask.bed.gz CAL:MVZCCGP-CaOr151_II-A04,MVZCCGP-CaOr155_II-E04,MVZCCGP-CaOr27_II-C07,MVZCCGP-CaOr24_I-C03,MVZCCGP-CaOr54_I-D06,MVZCCGP-CaOr61_I-H06,MVZCCGP-CaOr58_I-F06,MVZCCGP-CaOr75_I-C08,MVZCCGP-CaOr95_I-H09,MVZCCGP-CaOr157_II-F04,MVZCCGP-CaOr17_I-D02,MVZCCGP-CaOr19_I-F02,MVZCCGP-CaOr47_I-E05,MVZCCGP-CaOr41_I-H04,MVZCCGP-CaOr74_I-B08,MVZCCGP-CaOr158_II-G04,MVZCCGP-CaOr153_II-C04,MVZCCGP-CaOr39_I-F04,MVZCCGP-CaOr50_I-H05,MVZCCGP-CaOr33_I-A04,MVZCCGP-CaOr76_I-D08,MVZCCGP-CaOr101_I-F10,MVZCCGP-CaOr154_II-D04,MVZCCGP-CaOr56_I-E06,MVZCCGP-CaOr77_II-G01,MVZCCGP-CaOr82_I-F08,MVZCCGP-CaOr21_I-H02,MVZCCGP-CaOr35_I-C04,MVZCCGP-CaOr40_I-G04,MVZCCGP-CaOr52_I-B06,MVZCCGP-CaOr30_I-F03,MVZCCGP-CaOr79_II-A02,MVZCCGP-CaOr83_I-G08,MVZCCGP-CaOr94_I-G09,MVZCCGP-CaOr10_II-G06,MVZCCGP-CaOr12_II-E05,MVZCCGP-CaOr34_I-B04,MVZCCGP-CaOr67_I-D07,MVZCCGP-CaOr1_II-D06,MVZCCGP-CaOr14_I-C02,MVZCCGP-CaOr102_I-G10,MVZCCGP-CaOr37_II-A01,MVZCCGP-CaOr4_I-C01,MVZCCGP-CaOr53_I-C06,MVZCCGP-CaOr51_I-A06,MVZCCGP-CaOr49_I-G05,MVZCCGP-CaOr60_II-C01,MVZCCGP-CaOr64_I-B07,MVZCCGP-CaOr66_I-C07,MVZCCGP-CaOr71_II-F01,MVZCCGP-CaOr90_I-E09,MVZCCGP-CaOr80_I-E08,MVZCCGP-CaOr9_II-F06,MVZCCGP-CaOr96_I-A10,MVZCCGP-CaOr97_I-B10,MVZCCGP-CaOr159_II-H04,MVZCCGP-CaOr2_I-B01,MVZCCGP-CaOr63_I-A07,MVZCCGP-CaOr69_I-F07,MVZCCGP-CaOr7_I-E01,MVZCCGP-CaOr81_II-B02,MVZCCGP-CaOr88_I-C09,MVZCCGP-CaOr13_I-B02,MVZCCGP-CaOr28_II-D07,MVZCCGP-CaOr43_I-A05,MVZCCGP-CaOr91_I-F09,MVZCCGP-CaOr25_I-D03,MVZCCGP-CaOr38_I-E04,MVZCCGP-CaOr48_I-F05,MVZCCGP-CaOr32_I-H03,MVZCCGP-CaOr87_I-B09,MVZCCGP-CaOr89_I-D09,MVZCCGP-CaOr100_I-E10,MVZCCGP-CaOr104_I-H10,MVZCCGP-CaOr23_I-B03,MVZCCGP-CaOr3_II-A07,MVZCCGP-CaOr44_I-B05,MVZCCGP-CaOr31_I-G03,MVZCCGP-CaOr59_I-G06,MVZCCGP-CaOr68_I-E07,MVZCCGP-CaOr70_I-G07,MVZCCGP-CaOr72_I-H07,MVZCCGP-CaOr73_I-A08,MVZCCGP-CaOr85_I-H08,MVZCCGP-CaOr98_I-C10,MVZCCGP-CaOr26_II-B07,MVZCCGP-CaOr86_I-A09,MVZCCGP-CaOr11_I-A02,MVZCCGP-CaOr20_I-G02,MVZCCGP-CaOr29_I-E03,MVZCCGP-CaOr22_I-A03,MVZCCGP-CaOr45_I-C05,MVZCCGP-CaOr46_I-D05,MVZCCGP-CaOr78_II-H01,MVZCCGP-CaOr152_II-B04,MVZCCGP-CaOr18_I-E02,MVZCCGP-CaOr5_I-D01,MVZCCGP-CaOr57_II-B01,MVZCCGP-CaOr99_I-D10,MVZCCGP-CaOr156_II-A06,MVZCCGP-CaOr161_II-B06,MVZCCGP-CaOr65_II-E01,MVZCCGP-CaOr8_II-E06
	done
done <"Quail_largeautosome_list.txt"


#run estimate function on all scaffolds

smc++ estimate --timepoints 1e3 1e6 --cores 8 --spline cubic 3.14e-09 *.smc.gz

#plot SMC++ results
smc++ plot --linear CalQuail_SMCplot_final.png -c  model.final.json
smc++ plot --linear CalQuail_SMCopt_final.png -c .model.*.json

